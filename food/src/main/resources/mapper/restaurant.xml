<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="restaurant"> <!-- mapper파일의 이름 -->
	<!-- 레스토랑 목록 조회 -->
	<select id="restaurantList" parameterType="restaurant.RestaurantVo" resultType="restaurant.RestaurantVo">
		SELECT * FROM restaurant
		<!--  <include refid = "restaurantWhere"/>-->
		<where>
			<if test ="searchType ==''">   
			 	(r_name LIKE '%${searchWord}%' OR r_status LIKE '%${searchWord}%')
			 </if>
			 <if test= "searchType != null and searchType != ''">
			 	${searchType} LIKE '%${searchWord}%'
			 </if>
			 <if test="r_no > 0">    
			 	AND r_no = ${r_no}
			 </if>
		</where>  
		ORDER BY r_regdate DESC    
		LIMIT ${startIdx},10
	</select>
	
	<sql id = "restaurantWhere">
		<where>
			<if test ="searchType ==''">   
			 	(r_name LIKE '%${searchWord}%' OR r_status LIKE '%${searchWord}%')
			 </if>
			 <if test= "searchType != null and searchType != ''">
			 	${searchType} LIKE '%${searchWord}%'
			 </if>
			 <if test="r_no > 0">    
			 	AND r_no = ${r_no}
			 </if>
		</where>     
	</sql>
	<select id="restaurantCount" resultType="int" parameterType="restaurant.RestaurantVo">
		SELECT COUNT(*) FROM restaurant
		<include refid="restaurantWhere"/>
	</select>
	
	<select id="restaurantQnaList" parameterType="restaurant.RestaurantQnaVo" resultType="restaurant.RestaurantQnaVo">
		SELECT 
		       rqna_no
		     , rqna_title
		     , rqna_contents
		     , rqna_filename_org
		     , rqna_filename_real
		     , rqna_regdate
		     , rqna_status
		     , u_no
		     , a_no
		FROM restqna
		WHERE 1 = 1
		<choose>
			<when test='searchType == "title"'>
			  AND rqna_title LIKE '%${searchWord}%'
			</when>
			<when test='searchType == "contents"'>
			 AND rqna_contents LIKE '%${searchWord}%'
			</when>
			<otherwise>
			 AND (rqna_title LIKE '%${searchWord}%' or rqna_contents LIKE '%${searchWord}%')
			</otherwise>
		</choose>
		ORDER BY rqna_regdate DESC    
		LIMIT ${startIdx},10
	</select>
	
	<!-- 레스토랑 목록 카운트 -->
	<select id="restaurantQnaCount" resultType="int" parameterType="restaurant.RestaurantQnaVo">
		SELECT COUNT(*) /*restaurantQna.xml - restaurantCount :: 레스토랑 목록 카운트*/ 
		FROM restqna
		WHERE 1 = 1
		<choose>
			<when test='searchType == "title"'>
			  AND rqna_title LIKE '%${searchWord}%'
			</when>
			<when test='searchType == "contents"'>
			 AND rqna_contents LIKE '%${searchWord}%'
			</when>
			<otherwise>
			 AND (rqna_title LIKE '%${searchWord}%' or rqna_contents LIKE '%${searchWord}%')
			</otherwise>
		</choose>
	</select>
	<!-- 삭제 -->
	<delete id="restaurantDelete" >
		DELETE FROM restaurant WHERE r_no=#{r_no}
	</delete>
	<delete id="requestDelete" >
		DELETE FROM restqna WHERE rqna_no=#{rqna_no}
	</delete>
	<!-- DB에 인서트 -->
	<insert id="insert" parameterType="restaurant.RestaurantVo">
		INSERT INTO 
		restaurant 
		 (
			r_name, r_zipcode, r_address, r_tel, r_menu, r_week, r_breaktime, r_holiday, r_parking, r_price, r_foodtype, r_side, a_no,r_regdate
		) VALUES (
			#{r_name},#{r_zipcode},#{r_address},#{r_tel},#{r_menu},#{r_week},#{r_breaktime},#{r_holiday}, #{r_parking}, #{r_price}, #{r_foodtype},#{r_side},#{a_no},NOW()
		)
	</insert>
	<!-- 상세페이지 -->
	<select id="no_select" parameterType="int" resultType="restaurant.RestaurantQnaVo">
		SELECT * FROM shop.restqna WHERE rqna_no = #{xxx} 
	</select>
</mapper>
